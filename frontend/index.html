<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LYDO Manolo Fortich System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .admin-only { display: none; }
        .form-section-title { font-weight: bold; color: #0d6efd; margin-top: 15px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .barangay-card { cursor: pointer; transition: transform 0.2s; height: 100%; }
        .barangay-card:hover { transform: scale(1.03); background-color: #f8f9fa; border-color: #0d6efd; }
    </style>
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4 sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="showDashboard()">LYDO Manolo Fortich</a>
            <div class="d-flex text-white align-items-center">
                <span id="user-display" class="me-3" style="display:none;">Admin: <b id="username-span"></b></span>
                <button id="login-btn" class="btn btn-light btn-sm" onclick="showLoginModal()">Login</button>
                <button id="logout-btn" class="btn btn-danger btn-sm" onclick="logout()" style="display:none;">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div id="dashboard-view">
            <h3 class="mb-4 text-center">Select a Barangay to Manage</h3>
            <div class="row g-3" id="barangay-grid"></div>
        </div>

        <div id="list-view" style="display:none;">
            <div class="card shadow">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <button class="btn btn-outline-secondary btn-sm me-3" onclick="showDashboard()">← Back</button>
                        <h4 class="mb-0" id="current-barangay-title">Barangay Youth</h4>
                    </div>
                    <button class="btn btn-primary admin-only" onclick="openModal()">+ Add Youth to this Barangay</button>
                </div>
                <div class="card-body">
                    <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search name in this barangay..." onkeyup="filterTable()">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Name</th>
                                    <th>Age</th>
                                    <th>Sex</th>
                                    <th>Purok</th>
                                    <th>Education</th>
                                    <th class="admin-only">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="youth-data"></tbody>
                        </table>
                        <div id="empty-msg" class="text-center text-muted mt-3" style="display:none;">No records found for this Barangay.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="authModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Admin Login</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form onsubmit="handleAuth(event)">
                        <input type="text" id="auth-username" class="form-control mb-2" placeholder="Username" required>
                        <input type="password" id="auth-password" class="form-control mb-3" placeholder="Password" required>
                        <button type="submit" class="btn btn-primary w-100">Login</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="youthModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title">Youth Profile Form</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="youthForm" onsubmit="saveYouth(event)">
                        <input type="hidden" id="youth-id">
                        <ul class="nav nav-tabs mb-3" id="formTabs">
                            <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#tab-personal">Personal</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-groups">Groups/Needs</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-edu">Edu & Work</a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-civic">Civic & Other</a></li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="tab-personal">
                                <div class="row g-3">
                                    <div class="col-12"><label>Full Name</label><input type="text" id="name" class="form-control" required></div>
                                    <div class="col-md-6"><label>Birthdate</label><input type="date" id="birthdate" class="form-control"></div>
                                    <div class="col-md-6"><label>Sex</label><select id="sex" class="form-select"><option>Male</option><option>Female</option></select></div>
                                    <div class="col-md-6"><label>Civil Status</label><select id="civil_status" class="form-select"><option>Single</option><option>Married</option><option>Widowed</option><option>Separated</option><option>Live-in</option></select></div>
                                    <div class="col-md-6"><label>Religion</label><input type="text" id="religion" class="form-control"></div>
                                    <h6 class="form-section-title">Address & Contact</h6>
                                    <div class="col-md-6"><label>Barangay</label><select id="barangay_id" class="form-select bg-light" required readonly style="pointer-events: none;"></select></div>
                                    <div class="col-md-6"><label>Purok</label><input type="text" id="purok" class="form-control"></div>
                                    <div class="col-md-6"><label>Municipality</label><input type="text" class="form-control" value="Manolo Fortich" readonly></div>
                                    <div class="col-md-6"><label>Province</label><input type="text" class="form-control" value="Bukidnon" readonly></div>
                                    <div class="col-md-6"><label>Email</label><input type="email" id="email" class="form-control"></div>
                                    <div class="col-md-6"><label>Mobile No.</label><input type="text" id="contact_number" class="form-control"></div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="tab-groups">
                                <div class="row g-3">
                                    <h6 class="form-section-title">Youth Classification</h6>
                                    <div class="col-md-3 form-check ms-3"><input type="checkbox" class="form-check-input" id="is_in_school"> <label>In School</label></div>
                                    <div class="col-md-3 form-check"><input type="checkbox" class="form-check-input" id="is_working_youth"> <label>Working Youth</label></div>
                                    <div class="col-12 bg-light p-2 rounded">
                                        <div class="form-check"><input type="checkbox" class="form-check-input" id="is_osy" onchange="toggleOSY()"> <label><strong>Out of School Youth (OSY)</strong></label></div>
                                        <div id="osy-section" class="mt-2 ms-3 d-none">
                                            <div class="form-check"><input type="checkbox" class="form-check-input" id="osy_willing_to_enroll"> <label>Willing to enroll?</label></div>
                                            <div class="row mt-2">
                                                <div class="col-6"><label>Program:</label><select id="osy_program_type" class="form-select"><option value="">--</option><option>Educational</option><option>Vocational</option></select></div>
                                                <div class="col-6"><label>Reason if No:</label><input type="text" id="osy_reason_no_enroll" class="form-control"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <h6 class="form-section-title">Special Needs</h6>
                                    <div class="col-md-6"><div class="form-check"><input type="checkbox" class="form-check-input" id="is_pwd"> <label>PWD</label></div><input type="text" id="disability_type" class="form-control mt-1" placeholder="Type of Disability"></div>
                                    <div class="col-md-6"><div class="form-check"><input type="checkbox" class="form-check-input" id="has_specific_needs"> <label>Specific Needs</label></div>
                                        <select id="specific_needs_condition" class="form-select mt-1"><option value="">None</option><option value="SLD">Specific Learning Disability</option><option value="OHI">Other Hearing Impairment</option><option value="ASD">Autism</option><option value="VI">Visual Impairment</option><option value="HI">Hearing Impairment</option><option value="Deafness">Deafness</option></select>
                                    </div>
                                    <h6 class="form-section-title">Cultural Groups</h6>
                                    <div class="col-md-6"><div class="form-check"><input type="checkbox" class="form-check-input" id="is_ip"> <label>7 Tribes</label></div>
                                        <select id="tribe_name" class="form-select mt-1"><option value="">-- Select Tribe --</option><option>Higaonon</option><option>Tala-andig</option><option>Bukidnon</option><option>Umayamnon</option><option>Manobo</option><option>Matigsalug</option><option>Tigwahanon</option></select>
                                    </div>
                                    <div class="col-md-6"><div class="form-check"><input type="checkbox" class="form-check-input" id="is_muslim"> <label>Muslim</label></div>
                                        <select id="muslim_group" class="form-select mt-1"><option value="">-- Select Group --</option><option>Tausug</option><option>Maranao</option><option>Maguindanao</option><option>Yakan</option><option>Sama-bajau</option></select>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="tab-edu">
                                <div class="row g-3">
                                    <div class="col-md-6"><label>Highest Education</label><select id="education_level" class="form-select"><option>Elementary</option><option>High School</option><option>Senior High</option><option>Open High</option><option>ALS</option><option>College</option><option>Masters</option><option>Doctorate</option></select></div>
                                    <div class="col-md-6"><label>Course</label><input type="text" id="course" class="form-control"></div>
                                    <div class="col-12"><label>School/University</label><input type="text" id="school_name" class="form-control"></div>
                                    <div class="col-12 bg-light p-2 rounded mt-2"><div class="form-check"><input type="checkbox" class="form-check-input" id="is_scholar"> <label>Scholarship Beneficiary</label></div><input type="text" id="scholarship_program" class="form-control mt-1 ms-3 w-75" placeholder="Name of Program"></div>
                                    <div class="col-12 mt-3"><label>Work Status</label><input type="text" id="work_status" class="form-control" placeholder="e.g. Employed, Unemployed"></div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="tab-civic">
                                <div class="row g-3">
                                    <h6 class="form-section-title">Voter Status</h6>
                                    <div class="col-md-4 form-check ms-3"><input type="checkbox" class="form-check-input" id="registered_voter_sk"> <label>SK Voter</label></div>
                                    <div class="col-md-4 form-check"><input type="checkbox" class="form-check-input" id="registered_voter_national"> <label>National Voter</label></div>
                                    <div class="col-md-4 form-check"><input type="checkbox" class="form-check-input" id="voted_last_sk"> <label>Voted Last SK?</label></div>
                                    <h6 class="form-section-title">KK Assembly</h6>
                                    <div class="col-12"><div class="form-check"><input type="checkbox" class="form-check-input" id="attended_kk_assembly"> <label>Attended Assembly?</label></div></div>
                                    <div class="col-md-6"><label>If Yes, How many times?</label><input type="number" id="kk_assembly_times" class="form-control" min="0"></div>
                                    <div class="col-md-6"><label>If No, Reason:</label><select id="kk_assembly_no_reason" class="form-select"><option value="">--</option><option>No KK assembly</option><option>No interest</option></select></div>
                                    <h6 class="form-section-title">Other</h6>
                                    <div class="col-md-6 form-check ms-3"><input type="checkbox" class="form-check-input" id="is_4ps"> <label>4Ps Beneficiary</label></div>
                                    <div class="col-md-6"><label>No. of Children</label><input type="number" id="number_of_children" class="form-control" min="0"></div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 text-end">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-success px-4">Save Profile</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="summaryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="summary-title">Youth Full Profile</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="summary-content"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const BARANGAYS = [
            {id: 1, name: "Agusan Canyon"}, {id: 2, name: "Alae"}, {id: 3, name: "Dahilayan"}, 
            {id: 4, name: "Dalirig"}, {id: 5, name: "Damilag"}, {id: 6, name: "Diclum"}, 
            {id: 7, name: "Guilang-guilang"}, {id: 8, name: "Kalugmanan"}, {id: 9, name: "Lindaban"}, 
            {id: 10, name: "Lingion"}, {id: 11, name: "Lunocan"}, {id: 12, name: "Maluko"}, 
            {id: 13, name: "Mambatangan"}, {id: 14, name: "Mampayag"}, {id: 15, name: "Mantibugao"}, 
            {id: 16, name: "Minsuro"}, {id: 17, name: "San Miguel"}, {id: 18, name: "Sankanan"}, 
            {id: 19, name: "Santiago"}, {id: 20, name: "Santo Niño"}, {id: 21, name: "Tankulan"}, {id: 22, name: "Ticala"}
        ];

        let isLoggedIn = false;
        let allYouths = [];
        let currentBarangayId = null;

        document.addEventListener("DOMContentLoaded", () => {
            renderDashboard();
            populateBarangayDropdown();
            checkUserStatus();
            fetchYouths();
        });

        function renderDashboard() {
            const grid = document.getElementById('barangay-grid');
            grid.innerHTML = BARANGAYS.map(b => `
                <div class="col-md-3 col-sm-6">
                    <div class="card barangay-card shadow-sm text-center p-3" onclick="openBarangay(${b.id}, '${b.name}')">
                        <h5 class="mb-0 text-primary">${b.name}</h5>
                        <small class="text-muted">Click to Manage</small>
                    </div>
                </div>
            `).join('');
        }

        function populateBarangayDropdown() {
            const select = document.getElementById('barangay_id');
            select.innerHTML = BARANGAYS.map(b => `<option value="${b.id}">${b.name}</option>`).join('');
        }

        function openBarangay(id, name) {
            currentBarangayId = id;
            document.getElementById('current-barangay-title').innerText = `${name} Youth Records`;
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('list-view').style.display = 'block';
            filterTable();
        }

        function showDashboard() {
            currentBarangayId = null;
            document.getElementById('dashboard-view').style.display = 'block';
            document.getElementById('list-view').style.display = 'none';
        }

        function checkUserStatus() {
            fetch('/api/user/').then(res => res.ok ? res.json() : null).then(data => {
                if(data && data.is_authenticated) {
                    isLoggedIn = true;
                    document.getElementById('user-display').style.display = 'block';
                    document.getElementById('username-span').innerText = data.username;
                    document.getElementById('login-btn').style.display = 'none';
                    document.getElementById('logout-btn').style.display = 'block';
                    document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'inline-block');
                }
            });
        }
        function showLoginModal() { new bootstrap.Modal(document.getElementById('authModal')).show(); }
        function handleAuth(e) {
            e.preventDefault();
            fetch('/api/login/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    username: document.getElementById('auth-username').value,
                    password: document.getElementById('auth-password').value
                })
            }).then(res => res.json()).then(data => {
                if(data.message) window.location.reload();
                else alert(data.error);
            });
        }
        function logout() { fetch('/api/logout/').then(() => window.location.reload()); }

        function fetchYouths() {
            fetch('/api/youth/').then(res => res.json()).then(data => {
                allYouths = data;
                if(currentBarangayId) filterTable();
            });
        }

        function filterTable() {
            if (!currentBarangayId) return;
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allYouths.filter(y => 
                y.barangay_id === currentBarangayId && 
                y.name.toLowerCase().includes(term)
            );
            renderRows(filtered);
        }

        function renderRows(data) {
            const tbody = document.getElementById('youth-data');
            const emptyMsg = document.getElementById('empty-msg');
            if (data.length === 0) {
                tbody.innerHTML = '';
                emptyMsg.style.display = 'block';
                return;
            }
            emptyMsg.style.display = 'none';
            tbody.innerHTML = data.map(y => `
                <tr>
                    <td>${y.name}</td>
                    <td>${y.age}</td>
                    <td>${y.sex}</td>
                    <td>${y.full_data.purok || '-'}</td>
                    <td>${y.education_level}</td>
                    <td class="admin-only">
                    <div class="btn-group">
                         <button class="btn btn-sm btn-primary" onclick='viewFullSummary(${JSON.stringify(y)})'>View Summary</button>
                        <button class="btn btn-sm btn-info" onclick='editYouth(${JSON.stringify(y)})'>Edit</button>
                        <button class="btn btn-sm btn-danger" onclick='deleteYouth(${y.id}, "${y.name}")'>Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');
            if(isLoggedIn) document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'table-cell');
        }

        function openModal() {
            document.getElementById('youthForm').reset();
            document.getElementById('youth-id').value = '';
            if (currentBarangayId) document.getElementById('barangay_id').value = currentBarangayId;
            toggleOSY();
            new bootstrap.Modal(document.getElementById('youthModal')).show();
        }

        function editYouth(y) {
            const d = y.full_data;
            const setVal = (id, val) => document.getElementById(id).value = val || '';
            const setCheck = (id, val) => document.getElementById(id).checked = val || false;
            setVal('youth-id', y.id);
            setVal('name', y.name);
            setVal('birthdate', d.birthdate);
            setVal('sex', y.sex);
            setVal('civil_status', d.civil_status);
            setVal('religion', d.religion);
            setVal('barangay_id', d.barangay_id);
            setVal('purok', d.purok);
            setVal('email', d.email);
            setVal('contact_number', d.contact_number);
            setCheck('is_in_school', d.is_in_school);
            setCheck('is_osy', d.is_osy);
            setCheck('osy_willing_to_enroll', d.osy_willing_to_enroll);
            setVal('osy_program_type', d.osy_program_type);
            setVal('osy_reason_no_enroll', d.osy_reason_no_enroll);
            toggleOSY();
            setCheck('is_working_youth', d.is_working_youth);
            setCheck('is_pwd', d.is_pwd);
            setVal('disability_type', d.disability_type);
            setCheck('has_specific_needs', d.has_specific_needs);
            setVal('specific_needs_condition', d.specific_needs_condition);
            setCheck('is_ip', d.is_ip);
            setVal('tribe_name', d.tribe_name);
            setCheck('is_muslim', d.is_muslim);
            setVal('muslim_group', d.muslim_group);
            setVal('education_level', y.education_level);
            setVal('course', d.course);
            setVal('school_name', d.school_name);
            setCheck('is_scholar', d.is_scholar);
            setVal('scholarship_program', d.scholarship_program);
            setVal('work_status', d.work_status);
            setCheck('registered_voter_sk', d.registered_voter_sk);
            setCheck('registered_voter_national', d.registered_voter_national);
            setCheck('voted_last_sk', d.voted_last_sk);
            setCheck('attended_kk_assembly', d.attended_kk_assembly);
            setVal('kk_assembly_times', d.kk_assembly_times);
            setVal('kk_assembly_no_reason', d.kk_assembly_no_reason);
            setCheck('is_4ps', d.is_4ps);
            setVal('number_of_children', d.number_of_children);
            new bootstrap.Modal(document.getElementById('youthModal')).show();
        }

        function saveYouth(e) {
            e.preventDefault();
            const getVal = (id) => document.getElementById(id).value;
            const getCheck = (id) => document.getElementById(id).checked;

            // SAFETY CHECK: Ensure positive values only for number fields
            let kk_times = parseInt(getVal('kk_assembly_times')) || 0;
            let num_children = parseInt(getVal('number_of_children')) || 0;

            const data = {
                id: getVal('youth-id'),
                name: getVal('name'),
                birthdate: getVal('birthdate'),
                sex: getVal('sex'),
                civil_status: getVal('civil_status'),
                religion: getVal('religion'),
                barangay_id: getVal('barangay_id'),
                purok: getVal('purok'),
                email: getVal('email'),
                contact_number: getVal('contact_number'),
                is_in_school: getCheck('is_in_school'),
                is_osy: getCheck('is_osy'),
                osy_willing_to_enroll: getCheck('osy_willing_to_enroll'),
                osy_program_type: getVal('osy_program_type'),
                osy_reason_no_enroll: getVal('osy_reason_no_enroll'),
                is_working_youth: getCheck('is_working_youth'),
                is_pwd: getCheck('is_pwd'),
                disability_type: getVal('disability_type'),
                has_specific_needs: getCheck('has_specific_needs'),
                specific_needs_condition: getVal('specific_needs_condition'),
                is_ip: getCheck('is_ip'),
                tribe_name: getVal('tribe_name'),
                is_muslim: getCheck('is_muslim'),
                muslim_group: getVal('muslim_group'),
                education_level: getVal('education_level'),
                course: getVal('course'),
                school_name: getVal('school_name'),
                is_scholar: getCheck('is_scholar'),
                scholarship_program: getVal('scholarship_program'),
                work_status: getVal('work_status'),
                registered_voter_sk: getCheck('registered_voter_sk'),
                registered_voter_national: getCheck('registered_voter_national'),
                voted_last_sk: getCheck('voted_last_sk'),
                attended_kk_assembly: getCheck('attended_kk_assembly'),
                kk_assembly_times: Math.max(0, kk_times), // Ensure zero or positive
                kk_assembly_no_reason: getVal('kk_assembly_no_reason'),
                is_4ps: getCheck('is_4ps'),
                number_of_children: Math.max(0, num_children) // Ensure zero or positive
            };

            const method = data.id ? 'PUT' : 'POST';
            fetch('/api/youth/', {
                method: method,
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            }).then(res => {
                if(res.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('youthModal')).hide();
                    fetchYouths();
                } else {
                    res.json().then(e => alert(e.error));
                }
            });
        }

        function toggleOSY() {
            const isOsy = document.getElementById('is_osy').checked;
            document.getElementById('osy-section').classList.toggle('d-none', !isOsy);
        }

        function deleteYouth(id, name) {
    if (confirm(`Are you sure you want to delete the record for ${name}?`)) {
        fetch('/api/youth/', {
            method: 'DELETE',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id: id })
        }).then(res => {
            if(res.ok) {
                alert('Deleted successfully');
                fetchYouths(); // Refresh the table
            } else {
                res.json().then(e => alert(e.error));
            }
        });
    }
}
function deleteYouth(id, name) {
            if (confirm(`Are you sure you want to delete the record for ${name}?`)) {
                fetch('/api/youth/', {
                    method: 'DELETE',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ id: id })
                }).then(res => {
                    if(res.ok) {
                        alert('Deleted successfully');
                        fetchYouths();
                    } else {
                        res.json().then(e => alert(e.error));
                    }
                });
            }
        }
        function viewFullSummary(y) {
            const d = y.full_data;
            const content = document.getElementById('summary-content');
            
            const fmt = (val) => val ? '<span class="text-success fw-bold">Yes</span>' : '<span class="text-danger">No</span>';

            content.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6 border-end">
                        <h6 class="text-primary border-bottom">Personal Information</h6>
                        <p><strong>Name:</strong> ${y.name}</p>
                        <p><strong>Sex:</strong> ${y.sex} | <strong>Status:</strong> ${d.civil_status}</p>
                        <p><strong>Birthdate:</strong> ${d.birthdate || 'N/A'}</p>
                        <p><strong>Religion:</strong> ${d.religion || 'N/A'}</p>
                        <p><strong>Contact:</strong> ${d.contact_number || 'N/A'}</p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-primary border-bottom">Education & Work</h6>
                        <p><strong>Level:</strong> ${y.education_level}</p>
                        <p><strong>Course:</strong> ${d.course || 'N/A'}</p>
                        <p><strong>School:</strong> ${d.school_name || 'N/A'}</p>
                        <p><strong>Work Status:</strong> ${d.work_status || 'N/A'}</p>
                        <p><strong>Scholar:</strong> ${fmt(d.is_scholar)} (${d.scholarship_program || 'N/A'})</p>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-4 border-end">
                        <h6 class="text-primary border-bottom">Classifications</h6>
                        <p>In School: ${fmt(d.is_in_school)}</p>
                        <p>OSY: ${fmt(d.is_osy)}</p>
                        <p>4Ps: ${fmt(d.is_4ps)}</p>
                    </div>
                    <div class="col-md-4 border-end">
                        <h6 class="text-primary border-bottom">Special Needs/Group</h6>
                        <p>PWD: ${fmt(d.is_pwd)} (${d.disability_type || 'None'})</p>
                        <p>IP/7 Tribes: ${fmt(d.is_ip)} (${d.tribe_name || 'N/A'})</p>
                        <p>Muslim: ${fmt(d.is_muslim)} (${d.muslim_group || 'N/A'})</p>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-primary border-bottom">Civic / Others</h6>
                        <p>SK Voter: ${fmt(d.registered_voter_sk)}</p>
                        <p>National Voter: ${fmt(d.registered_voter_national)}</p>
                        <p>Attended KK: ${fmt(d.attended_kk_assembly)} (${d.kk_assembly_times || 0} times)</p>
                    </div>
                </div>
            `;
            
            new bootstrap.Modal(document.getElementById('summaryModal')).show();
        }
    </script>
    </script>
</body>
</html>